import{p as R,d as _,s as z}from"./styles-38a11c49-5efcf429.js";import{ay as p,as as c,ax as k,aK as H,aI as P,aG as I,aH as $,aE as q,aB as M}from"./index-29233f38.js";import{G as F}from"./layout-e57aec3f-390ca9ba.js";import{r as K}from"./index-f7dc402e-0c793cf4.js";import"./edges-a0c69811-c83f9a84.js";import"./createText-b06b2794-91f01c03.js";import"./svgDraw-1b15aedc-211a3a56.js";import"./line-53c588d2-029dc44e.js";import"./array-b7dcf730-9f3ba611.js";import"./constant-b644328d-6af51708.js";const T=s=>M.sanitizeText(s,c());let S={dividerMargin:10,padding:5,textHeight:10,curve:void 0};const V=function(s,o,f,n){const e=Object.keys(s);p.info("keys:",e),p.info(s),e.forEach(function(i){var y;var l,r;const t=s[i],d={shape:"rect",id:t.id,domId:t.domId,labelText:T(t.id),labelStyle:"",style:"fill: none; stroke: black",padding:(y=(l=c().flowchart)==null?void 0:l.padding)!=null?y:(r=c().class)==null?void 0:r.padding};o.setNode(t.id,d),B(t.classes,o,f,n,t.id),p.info("setNode",d)})},B=function(s,o,f,n,e){const i=Object.keys(s);p.info("keys:",i),p.info(s),i.forEach(function(l){var g,h;var r,t;const a=s[l];let d="";a.cssClasses.length>0&&(d=d+" "+a.cssClasses.join(" "));const y={labelStyle:"",style:""},v=(g=a.label)!=null?g:a.id,b=0,m="class_box",u={labelStyle:y.labelStyle,shape:m,labelText:T(v),classData:a,rx:b,ry:b,class:d,style:y.style,id:a.id,domId:a.domId,tooltip:n.db.getTooltip(a.id,e)||"",haveCallback:a.haveCallback,link:a.link,width:a.type==="group"?500:void 0,type:a.type,padding:(h=(r=c().flowchart)==null?void 0:r.padding)!=null?h:(t=c().class)==null?void 0:t.padding};o.setNode(a.id,u),e&&o.setParent(a.id,e),p.info("setNode",u)})},W=function(s,o,f,n){p.info(s),s.forEach(function(e,i){var h;var l,r;const t=e,a="",d={labelStyle:"",style:""},y=t.text,v=0,b="note",m={labelStyle:d.labelStyle,shape:b,labelText:T(y),noteData:t,rx:v,ry:v,class:a,style:d.style,id:t.id,domId:t.id,tooltip:"",type:"note",padding:(h=(l=c().flowchart)==null?void 0:l.padding)!=null?h:(r=c().class)==null?void 0:r.padding};if(o.setNode(t.id,m),p.info("setNode",m),!t.class||!(t.class in n))return;const u=f+i,g={id:`edgeNote${u}`,classes:"relation",pattern:"dotted",arrowhead:"none",startLabelRight:"",endLabelLeft:"",arrowTypeStart:"none",arrowTypeEnd:"none",style:"fill:none",labelStyle:"",curve:I(S.curve,$)};o.setEdge(t.id,t.class,g,u)})},J=function(s,o){const f=c().flowchart;let n=0;s.forEach(function(e){var r;var i;n++;const l={classes:"relation",pattern:e.relation.lineType==1?"dashed":"solid",id:"id"+n,arrowhead:e.type==="arrow_open"?"none":"normal",startLabelRight:e.relationTitle1==="none"?"":e.relationTitle1,endLabelLeft:e.relationTitle2==="none"?"":e.relationTitle2,arrowTypeStart:A(e.relation.type1),arrowTypeEnd:A(e.relation.type2),style:"fill:none",labelStyle:"",curve:I(f==null?void 0:f.curve,$)};if(p.info(l,e),e.style!==void 0){const t=q(e.style);l.style=t.style,l.labelStyle=t.labelStyle}e.text=e.title,e.text===void 0?e.style!==void 0&&(l.arrowheadStyle="fill: #333"):(l.arrowheadStyle="fill: #333",l.labelpos="c",((r=(i=c().flowchart)==null?void 0:i.htmlLabels)!=null?r:c().htmlLabels)?(l.labelType="html",l.label='<span class="edgeLabel">'+e.text+"</span>"):(l.labelType="text",l.label=e.text.replace(M.lineBreakRegex,`
`),e.style===void 0&&(l.style=l.style||"stroke: #333; stroke-width: 1.5px;fill:none"),l.labelStyle=l.labelStyle.replace("color:","fill:"))),o.setEdge(e.id1,e.id2,l,n)})},Q=function(s){S={...S,...s}},U=async function(s,o,f,n){var h,L,N,E;p.info("Drawing class - ",o);const e=(h=c().flowchart)!=null?h:c().class,i=c().securityLevel;p.info("config:",e);const l=(L=e==null?void 0:e.nodeSpacing)!=null?L:50,r=(N=e==null?void 0:e.rankSpacing)!=null?N:50,t=new F({multigraph:!0,compound:!0}).setGraph({rankdir:n.db.getDirection(),nodesep:l,ranksep:r,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}}),a=n.db.getNamespaces(),d=n.db.getClasses(),y=n.db.getRelations(),v=n.db.getNotes();p.info(y),V(a,t,o,n),B(d,t,o,n),J(y,t),W(v,t,y.length+1,d);let b;i==="sandbox"&&(b=k("#i"+o));const m=i==="sandbox"?k(b.nodes()[0].contentDocument.body):k("body"),u=m.select(`[id="${o}"]`),g=m.select("#"+o+" g");if(await K(g,t,["aggregation","extension","composition","dependency","lollipop"],"classDiagram",o),H.insertTitle(u,"classTitleText",(E=e==null?void 0:e.titleTopMargin)!=null?E:5,n.db.getDiagramTitle()),P(t,u,e==null?void 0:e.diagramPadding,e==null?void 0:e.useMaxWidth),!(e!=null&&e.htmlLabels)){const C=i==="sandbox"?b.nodes()[0].contentDocument:document,G=C.querySelectorAll('[id="'+o+'"] .edgeLabel .label');for(const w of G){const D=w.getBBox(),x=C.createElementNS("http://www.w3.org/2000/svg","rect");x.setAttribute("rx",0),x.setAttribute("ry",0),x.setAttribute("width",D.width),x.setAttribute("height",D.height),w.insertBefore(x,w.firstChild)}}};function A(s){let o;switch(s){case 0:o="aggregation";break;case 1:o="extension";break;case 2:o="composition";break;case 3:o="dependency";break;case 4:o="lollipop";break;default:o="none"}return o}const X={setConf:Q,draw:U},ne={parser:R,db:_,renderer:X,styles:z,init:s=>{s.class||(s.class={}),s.class.arrowMarkerAbsolute=s.arrowMarkerAbsolute,_.clear()}};export{ne as diagram};
